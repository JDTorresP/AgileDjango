{#Load bootstrap django resources#}
{% load bootstrap3 %}
{% bootstrap_css %}
{% bootstrap_javascript %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Detalles</title>
</head>
<body>
<script type="text/javascript" src="https://w.soundcloud.com/player/api.js"></script>



<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <!-- Header -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="{% url 'gallery:index' %}">Galería Audios</a>
        </div>
        <!-- Items -->
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav"></ul>
            <ul class="nav navbar-nav navbar-right">
                {% if user.is_authenticated %}
                    <li><a href="{% url 'gallery:modUser' %}"><span class="glyphicon glyphicon-edit"
                                                                    aria-hidden="true"></span>&nbsp; {{ user.username }}
                    </a>
                    </li>
                    <li><a href="{% url 'gallery:logout' %}"> <span class="glyphicon glyphicon-off"
                                                                    aria-hidden="true"></span>&nbsp; Logout</a></li>
                {% else %}
                    <li><a href="{% url 'gallery:addUser' %}"> <span class="glyphicon glyphicon-plus"
                                                                     aria-hidden="true"></span>&nbsp;Registro</a></li>
                    <li><a href="{% url 'gallery:login' %}"><span class="glyphicon glyphicon-log-in"
                                                                  aria-hidden="true"></span>&nbsp; Login</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<div class="container" style="margin-top: 70px">
<iframe class="scPlayer" width="560" height="315" src="{{ video.soundCloud }}"
                            scrolling="no" frameborder="no"
                            allow="autoplay; encrypted-media" allowfullscreen></iframe>
        <h2 >Detalles</h2>
        <table class="table">
            <tbody>
                <tr>
                    <td>Titulo</td>
                    <td>{{video.title}}</td>
                </tr>
                <tr>
                    <td>Descripcion</td>
                    <td>{{video.description}}</td>
                </tr>
                <tr>
                    <td>Tipo</td>
                    <td>{{video.mediaType}} </td>
                </tr>
                <tr>
                    <td>Propietario</td>
                    <td>{{video.user}}</td>
                </tr>
                <tr>
                    <td>Categoria</td>
                    <td>{{video.category}}</td>
                </tr>
            </tbody>
        </table>

    <h2 >Clips</h2>
        <table class="table">
            <tbody>
            {%for clip in video.clips.all %}
                <tr>
                    <td>Titulo: {{clip.name}}</td>
                    <td>Inicio: {{clip.seg_initial}}</td>
                    <td>Fin: {{clip.seg_final}} </td>
                    <td><span class="glyphicon glyphicon-play" aria-hidden="true" style="cursor: pointer" onclick="playClip({{clip.seg_initial}},{{clip.seg_final}})"></span></td>
                </tr>

            {% endfor %}

            </tbody>
        </table>
    <h2 >Agregar clips</h2>
    <form action="{{ video.get_absolute_SC_url }}" enctype="multipart/form-data" method="post">
        {%csrf_token%}
        {% bootstrap_form form %}
        {% buttons %}
        <input type="submit" value="añadir" class="btn btn-primary btn-block"/>
        {% endbuttons %}
    </form>
</div>

<script>
    var iframe = document.querySelector('.scPlayer');
    var widget = SC.Widget(iframe);

    var clipTimer;

    function playClip(startTime, endTime){
        widget.play();
        clearTimeout(clipTimer);
        widget.seekTo(startTime*1000);
        clipTimer = setTimeout(pauseAudio, (endTime-startTime)*1000);
    }

    function pauseAudio(){
        widget.pause();
    }

</script>

</body>
</html>