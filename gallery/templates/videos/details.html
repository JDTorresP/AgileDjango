{#Load bootstrap django resources#}
{% load bootstrap3 %}
{% bootstrap_css %}
{% bootstrap_javascript %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Detalles</title>
</head>
<body>
<script>
  // 2. This code loads the IFrame Player API code asynchronously.
  var tag = document.createElement('script');

  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  // 3. This function creates an <iframe> (and YouTube player)
  //    after the API code downloads.
  var player;
  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      height: '390',
      width: '640',
      videoId: '{{ video.get_yt_code }}',
      events: {
          'onReady': onPlayerReady,
      }
    });
  }

  // 4. The API will call this function when the video player is ready
  function onPlayerReady(event) {
        event.target.playVideo();
      }

  var clipTimer;
    function playClip(starTime, endTime){
        player.playVideo();
        clearTimeout(clipTimer);
      player.seekTo(starTime, true);
      clipTimer = setTimeout(pauseVideo, (endTime-starTime)*1000);
    }

      function pauseVideo() {
        player.pauseVideo();
      }


</script>


<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <!-- Header -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="{% url 'gallery:index' %}">Galería Multimedia</a>
        </div>
        <!-- Items -->
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav"></ul>
            <ul class="nav navbar-nav navbar-right">
                {% if user.is_authenticated %}
                    <li><a href="{% url 'gallery:modUser' %}"><span class="glyphicon glyphicon-edit"
                                                                    aria-hidden="true"></span>&nbsp; {{ user.username }}
                    </a>
                    </li>
                    <li><a href="{% url 'gallery:logout' %}"> <span class="glyphicon glyphicon-off"
                                                                    aria-hidden="true"></span>&nbsp; Logout</a></li>
                {% else %}
                    <li><a href="{% url 'gallery:addUser' %}"> <span class="glyphicon glyphicon-plus"
                                                                     aria-hidden="true"></span>&nbsp;Registro</a></li>
                    <li><a href="{% url 'gallery:login' %}"><span class="glyphicon glyphicon-log-in"
                                                                  aria-hidden="true"></span>&nbsp; Login</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<div class="container" style="margin-top: 70px">
{#<iframe  width="560" height="315" src="https://youtube.com/embed/{{ video.get_yt_code }}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>#}
<div id="player"></div>
        <h2 >Detalles</h2>
        <table class="table">
            <tbody>
                <tr>
                    <td>Titulo</td>
                    <td>{{video.title}}</td>
                </tr>
                <tr>
                    <td>Descripcion</td>
                    <td>{{video.description}}</td>
                </tr>
                <tr>
                    <td>Tipo</td>
                    <td>{{video.mediaType}} </td>
                </tr>
                <tr>
                    <td>Propietario</td>
                    <td>{{video.user}}</td>
                </tr>
                <tr>
                    <td>Categoria</td>
                    <td>{{video.category}}</td>
                </tr>
            </tbody>
        </table>

    <h2 >Clips</h2>
        <table class="table">
            <tbody>
            {%for clip in video.clips.all %}
                <tr>
                    <td>Titulo: {{clip.name}}</td>
                    <td>Inicio: {{clip.seg_initial}}</td>
                    <td>Fin: {{clip.seg_final}} </td>
                    <td><span class="glyphicon glyphicon-play" aria-hidden="true" style="cursor: pointer" onclick="playClip({{clip.seg_initial}},{{clip.seg_final}})"></span></td>
                </tr>

            {% endfor %}

            </tbody>
        </table>
    <h2 >Agregar clips</h2>
    <form action="{{ video.get_absolute_url }}" enctype="multipart/form-data" method="post">
        {%csrf_token%}
        {% bootstrap_form form %}
        {% buttons %}
        {%if  auth == 1 %}
            <input type="submit" value="añadir" class="btn btn-primary btn-block"/>
            {% else %}
            <p>no tiene permisos para agregar</p>
        {%endif%}
        {% endbuttons %}
    </form>
</div>

</body>
</html>